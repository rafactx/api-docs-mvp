import{j as R,ai as J,aj as G,ag as H,aB as L,aG as te,$ as T,aE as X,ah as se,y as oe,z as ie,q as A,h as re,v as P,ax as ue}from"./theme.ChnCFiOV.js";import{m as ce}from"./Draggable.vue.BVx2gPV_.js";import{w as ve}from"./DeleteSidebarListElement.vue.TO3Y4m4y.js";import{C as de}from"./EditSidebarListElement.vue.TDEp-w3f.js";import{K as me,M as fe}from"./EnvironmentModal.vue.CQcEzv-Y.js";import{k as Y,a as E,f as U,w as Q,C as j,e as pe,z as C,D as f,U as d,v as Z,A as K,F as ee,P as ae,y as he,ap as ke,u as n,E as le,a8 as be,n as q,K as p,$ as ye,B as xe}from"./framework.ZtjFAS4N.js";import"./CommandActionInput.vue.Dlhp1Ac1.js";const ge=Y({__name:"EnvironmentForm",props:{collection:{},environment:{},workspace:{},envVariables:{}},setup(c){const{collectionMutators:i}=R(),u=E([]),$=E(new Set),g=E(new Map),h=E(!1),F=U(()=>{var e;if(!((e=c.environment)!=null&&e.value))return[{key:"",value:""}];try{const a=JSON.parse(c.environment.value),r=Object.entries(a).map(([t,l])=>({key:t,value:String(l)}));return r.length===0?[{key:"",value:""}]:r}catch{return[{key:"",value:""}]}}),z=U(()=>{const e=u.value[u.value.length-1];return e?e.key||e.value?[...u.value,{key:"",value:""}]:u.value:[{key:"",value:""}]}),V=U(()=>{const e=new Map;return u.value.forEach((a,r)=>{if(a.key){const t=e.get(a.key)||[];t.push(r),e.set(a.key,t)}}),g.value.forEach((a,r)=>{if(a){const t=e.get(a)||[];t.push(r),e.set(a,t)}}),Array.from(e.values()).filter(a=>a.length>1).flat()});Q(F,e=>{u.value=[...e],$.value=new Set(e.map(a=>a.key).filter(Boolean))},{immediate:!0});const M=async(e,a,r)=>{var t;if(!h.value){if(a==="key"){g.value.set(e,r);const l=new Set($.value),k=u.value[e];if(k&&l.delete(k.key),l.has(r))return}h.value=!0;try{const l=[...u.value],k=l[e];if(!k)return;l[e]={key:a==="key"?r:k.key,value:a==="value"?r:k.value},!l[e].key&&!l[e].value&&e!==l.length-1&&l.splice(e,1);const B=l.reduce((y,{key:O,value:s})=>((O||s)&&(y[O]=s),y),{});if(c.collection){const y={...c.collection["x-scalar-environments"],[c.environment.name]:{...(t=c.collection["x-scalar-environments"])==null?void 0:t[c.environment.name],variables:B}};await i.edit(c.collection.uid,"x-scalar-environments",y)}if(e===u.value.length-1){const y=l[l.length-1];y&&(y.key||y.value)&&await m()}await q(),u.value=l,a==="key"&&($.value=new Set(l.map(y=>y.key).filter(Boolean)),g.value.delete(e))}finally{h.value=!1}}},m=async()=>{var e;if(!h.value){h.value=!0;try{const a=[...u.value,{key:"",value:""}],r=a.reduce((t,{key:l,value:k})=>((l||k)&&(t[l]=k),t),{});if(c.collection){const t={...c.collection["x-scalar-environments"],[c.environment.name]:{...(e=c.collection["x-scalar-environments"])==null?void 0:e[c.environment.name],variables:r}};await i.edit(c.collection.uid,"x-scalar-environments",t)}await q(),u.value=a}finally{h.value=!1}}},S=async e=>{var a;if(!h.value){h.value=!0;try{const r=[...u.value];r.splice(e,1);const t=r.reduce((l,{key:k,value:B})=>((k||B)&&(l[k]=B),l),{});if(c.collection){const l={...c.collection["x-scalar-environments"],[c.environment.name]:{...(a=c.collection["x-scalar-environments"])==null?void 0:a[c.environment.name],variables:t}};await i.edit(c.collection.uid,"x-scalar-environments",l)}await q(),u.value=r}finally{h.value=!1}}},I=async()=>{if(u.value.length===0)await m();else if(u.value.length>=1){const e=u.value[u.value.length-1];e&&(e.key||e.value)&&await m()}};return pe(()=>{I()}),Q(()=>u.value,()=>{I()}),(e,a)=>(C(),j(se,{class:"group/table flex-1",columns:["",""]},{default:f(()=>[d(J,{class:"sr-only !block"},{default:f(()=>[d(G,null,{default:f(()=>a[0]||(a[0]=[K("Key")])),_:1}),d(G,null,{default:f(()=>a[1]||(a[1]=[K("Value")])),_:1})]),_:1}),(C(!0),Z(ee,null,ae(z.value,(r,t)=>(C(),j(J,{key:t,class:he({error:V.value.includes(t)})},{default:f(()=>[d(H,null,{default:f(()=>[d(L,{disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.key,placeholder:"Key",workspace:e.workspace,"onUpdate:modelValue":l=>M(t,"key",l)},ke({_:2},[V.value.includes(t)?{name:"icon",fn:f(()=>[d(n(te),{class:"text-red mr-0.75 size-3.5 brightness-[.9]"})]),key:"0"}:void 0]),1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024),d(H,null,{default:f(()=>[d(L,{class:"pr-6 group-hover:pr-10 group-has-[.cm-focused]:pr-10",disableCloseBrackets:"",disableEnter:"",disableTabIndent:"",lineWrapping:"",environment:e.environment,envVariables:e.envVariables,modelValue:r.value,placeholder:"Value",workspace:e.workspace,"onUpdate:modelValue":l=>M(t,"value",l)},{icon:f(()=>[r.key||r.value?(C(),j(n(T),{key:0,class:"text-c-2 hover:text-c-1 hover:bg-b-2 z-context hidden h-fit rounded p-1 group-hover:flex group-has-[.cm-focused]:flex",size:"sm",variant:"ghost",onClick:be(l=>S(t),["stop"])},{default:f(()=>[d(n(X),{class:"size-3.5"})]),_:2},1032,["onClick"])):le("",!0)]),_:2},1032,["environment","envVariables","modelValue","workspace","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1}))}}),we=oe(ge,[["__scopeId","data-v-efc6e074"]]),Ce={class:"flex h-full w-full flex-col gap-12 px-1.5 pt-8"},Ve={class:"flex flex-col gap-4"},_e={class:"rounded-lg border"},Ee={class:"bg-b-2 flex cursor-grab items-center justify-between rounded-t-lg px-1 py-1 text-sm"},Fe={class:"flex items-center"},ze=["onClick"],Se={class:"text-c-3 flex h-full items-center justify-center rounded-lg border p-4"},Oe=Y({__name:"CollectionEnvironment",setup(c){const{activeCollection:i,activeWorkspace:u,activeEnvVariables:$}=ie(),{collectionMutators:g}=R(),h=A(),F=A(),z=A(),V=A(),M=E(""),m=E(null),S=E(void 0),I=U(()=>{var s;return(s=i.value)!=null&&s["x-scalar-environments"]?Object.entries(i.value["x-scalar-environments"]).map(([o,b])=>({uid:o,name:o,value:JSON.stringify(b.variables||{}),color:b.color||"#FFFFFF"})):[]}),e=()=>{var s;!((s=i.value)!=null&&s.uid)||!m.value||(g.removeEnvironment(m.value,i.value.uid),F.hide())},a=s=>{m.value=s,F.show()},r=s=>{var o;(o=i.value)!=null&&o.uid&&(g.addEnvironment(s.name,{variables:{},color:s.color},i.value.uid),z.hide())},t=s=>{m.value=s.name,M.value=s.color||"#FFFFFF",h.show()},l=s=>{var o,b,v;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const x={...i.value["x-scalar-environments"],[m.value]:{variables:((v=(b=i.value["x-scalar-environments"])==null?void 0:b[m.value])==null?void 0:v.variables)||{},color:s}};g.edit(i.value.uid,"x-scalar-environments",x),h.hide()},k=s=>{m.value=s,S.value=s,V.show()},B=()=>{m.value=null,S.value=void 0,V.hide()},y=s=>{var o;if(!((o=i.value)!=null&&o.uid)||!m.value)return;const b={...i.value["x-scalar-environments"]};if(!b[m.value])return;const v={},x=Object.entries(b),w=x.findIndex(([_])=>_===m.value);x.forEach(([_,N],W)=>{W===w?v[s]=N:v[_]=N}),g.edit(i.value.uid,"x-scalar-environments",v),m.value=null,S.value=void 0,V.hide()},O=(s,o)=>{var b;if(!((b=i.value)!=null&&b.uid))return;const v={...i.value["x-scalar-environments"]},x={},w=Object.entries(v),_=w.findIndex(([D])=>D===s.id),N=w.findIndex(([D])=>D===o.id);if(_===-1||N===-1)return;const W=w[_];W&&(w.splice(_,1),w.splice(N,0,W),w.forEach(([D,ne])=>{x[D]=ne}),g.edit(i.value.uid,"x-scalar-environments",x))};return(s,o)=>(C(),j(ue,null,{default:f(()=>{var b;return[p("div",Ce,[p("div",Ve,[o[5]||(o[5]=p("div",{class:"flex items-start justify-between gap-2"},[p("div",{class:"flex flex-col gap-2"},[p("div",{class:"flex h-8 items-center"},[p("h3",{class:"font-bold"},"Environment Variables")]),p("p",{class:"text-sm"},[K(" Set environment variables at your collection level. Use "),p("code",{class:"font-code text-c-2"},"{{ variable }}"),K(" to add / search among the selected environment's variables in your request inputs. ")])])],-1)),(C(!0),Z(ee,null,ae(I.value,v=>(C(),j(n(ce),{key:v.name,id:v.name,isDraggable:!0,isDroppable:!0,parentIds:[],onOnDragEnd:O},{default:f(()=>[p("div",_e,[p("div",Ee,[p("div",Fe,[d(n(T),{class:"hover:bg-b-3 flex h-6 w-6 p-1",onClick:x=>t(v),variant:"ghost"},{default:f(()=>[p("span",{style:ye({backgroundColor:v.color||"#FFFFFF"}),class:"h-2.5 w-2.5 rounded-full"},null,4)]),_:2},1032,["onClick"]),p("button",{class:"hover:bg-b-3 rounded px-1 py-0.5 text-sm",onClick:x=>k(v.name)},xe(v.name),9,ze)]),d(n(T),{class:"hover:bg-b-3 hover:text-c-1 h-fit p-1.25",variant:"ghost",onClick:x=>a(v.name)},{default:f(()=>[d(n(X),{class:"size-3.5"})]),_:2},1032,["onClick"])]),n(i)&&n(u)?(C(),j(we,{key:0,collection:n(i),environment:v,envVariables:n($),workspace:n(u)},null,8,["collection","environment","envVariables","workspace"])):le("",!0)])]),_:2},1032,["id"]))),128)),p("div",Se,[d(n(T),{class:"hover:bg-b-2 hover:text-c-1 flex items-center gap-2",size:"sm",variant:"ghost",onClick:o[0]||(o[0]=v=>n(z).show())},{default:f(()=>[d(n(re),{class:"inline-flex",icon:"Add",size:"sm",thickness:"1.5"}),o[4]||(o[4]=p("span",null,"Add Environment",-1))]),_:1})])]),d(n(P),{size:"xxs",state:n(F),title:`Delete ${m.value||"Environment"}`},{default:f(()=>[d(ve,{variableName:"Environment",warningMessage:"Are you sure you want to delete this environment? This action cannot be undone.",onClose:o[1]||(o[1]=v=>n(F).hide()),onDelete:e})]),_:1},8,["state","title"]),d(me,{activeWorkspaceCollections:n(i)?[n(i)]:[],collectionId:(b=n(i))==null?void 0:b.uid,state:n(z),onCancel:o[2]||(o[2]=v=>n(z).hide()),onSubmit:r},null,8,["activeWorkspaceCollections","collectionId","state"]),d(fe,{selectedColor:M.value,state:n(h),onCancel:o[3]||(o[3]=v=>n(h).hide()),onSubmit:l},null,8,["selectedColor","state"]),d(n(P),{size:"xxs",state:n(V),title:`Edit ${m.value}`},{default:f(()=>[d(de,{name:S.value??"",onClose:B,onEdit:y},null,8,["name"])]),_:1},8,["state","title"])])]}),_:1}))}});export{Oe as default};
